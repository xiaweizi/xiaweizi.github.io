<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="下位子" />



<meta name="description" content="MVVM介绍 本篇这是基础入门篇，要想看源码剖析请移步到 DataBinding实现原理探析">
<meta name="keywords" content="MVVM,DataBinding">
<meta property="og:type" content="article">
<meta property="og:title" content="MVVM之DataBinding入门">
<meta property="og:url" content="http://xiaweizi.cn/article/41851/index.html">
<meta property="og:site_name" content="xiaweizi&#39;blog">
<meta property="og:description" content="MVVM介绍 本篇这是基础入门篇，要想看源码剖析请移步到 DataBinding实现原理探析">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4043475-6355339021fd68cb.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4043475-4f03698849422487.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4043475-50a7029e02b7693b.gif?imageMogr2/auto-orient/strip">
<meta property="og:updated_time" content="2018-03-09T02:14:16.496Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MVVM之DataBinding入门">
<meta name="twitter:description" content="MVVM介绍 本篇这是基础入门篇，要想看源码剖析请移步到 DataBinding实现原理探析">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/4043475-6355339021fd68cb.gif?imageMogr2/auto-orient/strip">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="xiaweizi&#39;blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>MVVM之DataBinding入门 | xiaweizi&#39;blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?d8f1e419497cfa5779f9e99baab1e7af";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">下位子</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/pdf/">书籍</a></li>
                        
                            <li><a href="/photos/">相册</a></li>
                        
                            <li><a href="/message/">留言板</a></li>
                        
                        </ul>
                    </nav>
                    <br>
                    <br>
                    <br>
                    <br>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:1012126908@qq.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" href="https://weibo.com/6444811129/profile?topnav=1&wvr=6" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/xiaweizi" title="GitHub"></a>
                            
                                <a class="fa 简书" href="https://www.jianshu.com/u/d36586119d8c" title="简书"></a>
                            
                                <a class="fa CSDN" href="http://blog.csdn.net/qq_22656383" title="CSDN"></a>
                            
                                <a class="fa QQ" href="http://wpa.qq.com/msgrd?v=3&uin=1012126908&site=qq&menu=yes" title="QQ"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DataBinding/">DataBinding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google-官方/">Google 官方</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/">Kotlin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVVM/">MVVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Material-Design/">Material Design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thinking-In-Java/">Thinking In Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图片缓存/">图片缓存</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工作积累/">工作积累</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具软件/">工具软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发效率/">开发效率</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能优化/">性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/提高效率/">提高效率</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/第三方库/">第三方库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自定义-View/">自定义 View</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/造轮子/">造轮子</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/项目/">项目</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/项目重构/">项目重构</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.wanandroid.com/">玩Android</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://github.com/G-Joker/WeaponApp">WeaponApp</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://weaponzhi.online">WeaponZhi</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://coding-dream.github.io">编程之乐</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://txiner.top/">Hundred Blog</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">下位子</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">下位子</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/pdf/">书籍</a></li>
                
                    <li><a href="/photos/">相册</a></li>
                
                    <li><a href="/message/">留言板</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:1012126908@qq.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="https://weibo.com/6444811129/profile?topnav=1&wvr=6" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/xiaweizi" title="GitHub"></a>
                            
                                <a class="fa 简书" target="_blank" href="https://www.jianshu.com/u/d36586119d8c" title="简书"></a>
                            
                                <a class="fa CSDN" target="_blank" href="http://blog.csdn.net/qq_22656383" title="CSDN"></a>
                            
                                <a class="fa QQ" target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=1012126908&site=qq&menu=yes" title="QQ"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-MVVM之DataBinding入门" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/article/41851/" class="article-date">
      <time datetime="2017-08-30T12:46:25.000Z" itemprop="datePublished">2017-08-30</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      MVVM之DataBinding入门
    </h1>
  

        
           <div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <span class="post-count">3,798 字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">16 分</span>
      </span>
    </span>

    
        <span id="busuanzi_container_page_pv">
          &nbsp; | &nbsp;  本文总阅读量: <span id="busuanzi_value_page_pv"></span> 次
        </span>
    
</div>
        
      </header>
      
      <div class="article-info article-info-post">
        
          <br>
          <br>
        
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术分享/">技术分享</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DataBinding/">DataBinding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVVM/">MVVM</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="MVVM介绍"><a href="#MVVM介绍" class="headerlink" title="MVVM介绍"></a>MVVM介绍</h1><blockquote>
<p>本篇这是基础入门篇，要想看源码剖析请移步到 <a href="http://www.jianshu.com/p/c4f5411cb0ae" target="_blank" rel="noopener">DataBinding实现原理探析</a></p>
</blockquote>
<a id="more"></a>
<p><code>MVVM</code>框架类似于早期的<code>MVC</code>和最热的<code>MVP</code>，但是比起这两个更为强势。<code>MV-VM</code>相比于<code>MVP</code>，其实就是将<code>Presenter</code>层替换成了<code>ViewModel</code>层，我们都知道，<code>MVP</code>的好处就是将逻辑代码从<code>View</code>层抽离出来，做到与UI层的低耦合，但是无形中会创造出许多的接口，有些接口很是冗余，不仅如此，当后期修改数据或者添加新的功能还需要修改或是添加接口，很是麻烦。</p>
<p>这个时候<code>MV-VM</code>的优势就体现出来了，<code>ViewModel</code>层所需要做的完全就是跟逻辑相关的代码，完全不会涉及到UI。当数据变化，直接驱动UI的改变，中间省去了冗余的接口。同时，在<code>ViewModel</code>层编写代码中，要求开发者需要将每个方法尽可能的做的功能单一，不与外部有任何的引用或者是联系，无形中提高了代码的健壮性，方便了后期的单元测试。</p>
<p><code>DataBinding</code>其实就是谷歌出台的工具，是实现UI和数据绑定的框架，<code>View</code>和<code>ViewModel</code>通过<code>DataBinding</code>实现单向绑定或双向绑定，做到UI和数据的相互监听，同时开发者的任务分配也就很明确了，负责<code>ViewModel</code>的小伙伴完全不用考虑UI如何实现，很大程度上提高了代码的开发效率和后期出问题跟踪的准确性，针对这些好处，采用<code>MVVM</code>进行代码开发还是非常有必要的。</p>
<h1 id="初步使用"><a href="#初步使用" class="headerlink" title="初步使用"></a>初步使用</h1><h2 id="1-module的build-gradle文件加上一行配置代码"><a href="#1-module的build-gradle文件加上一行配置代码" class="headerlink" title="1. module的build.gradle文件加上一行配置代码"></a>1. <code>module</code>的<code>build.gradle</code>文件加上一行配置代码</h2><pre><code>android {
    ...
    dataBinding {
        enabled = true
    }
}
</code></pre><h2 id="2-创建布局文件"><a href="#2-创建布局文件" class="headerlink" title="2. 创建布局文件"></a>2. 创建布局文件</h2><p>只需要在之前布局的基础上，外层嵌套 <code>&lt;layout&gt;&lt;/layout&gt;</code>即可。</p>
<pre><code>&lt;layout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;

    &lt;data&gt;
        &lt;variable
            name=&quot;student&quot;
            type=&quot;com.xiaweizi.bean.Student&quot;/&gt;
        &lt;!-- 这里 type 必须传完整路径，或者用 import 方式也是可以的 --&gt;
        &lt;!--
            &lt;import type=&quot;com.xiaweizi.bean.Student&quot;/&gt;
            &lt;variable
                name=&quot;student&quot;
                type=&quot;Student&quot;/&gt;
        --&gt;
    &lt;/data&gt;

    &lt;!-- 对应之前的XML文件 --&gt;
    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
        android:gravity=&quot;center_horizontal&quot;
        android:orientation=&quot;vertical&quot;&gt;

    &lt;/LinearLayout&gt;
&lt;/layout&gt;
</code></pre><p>因为<code>XML</code>是不支持自定义导包的，所以通过<code>import</code>先导包，如果类名相同的话可以通过<code>alias</code>进行区分：</p>
<pre><code>&lt;import type=&quot;android.view.View&quot;/&gt;
&lt;import type=&quot;com.xiaweizi.View&quot;
        alias=&quot;MyView&quot;/&gt;

&lt;variable
    name=&quot;view1&quot;
    type=&quot;View&quot;/&gt;

&lt;variable
    name=&quot;view2&quot;
    type=&quot;MyView&quot;/&gt;
</code></pre><p>这个时候会在<code>app\build\generated\source\debug\包名</code>路径下生成对应的<code>binding</code>类，命名方式，举个例子最为直接：</p>
<pre><code>原XML名:activity_main  ----&gt; 生成对应的binding名: ActivityMainBinding
</code></pre><h2 id="3-Activity中替换原来的setContentView-代码"><a href="#3-Activity中替换原来的setContentView-代码" class="headerlink" title="3. Activity中替换原来的setContentView()代码"></a>3. <code>Activity</code>中替换原来的<code>setContentView()</code>代码</h2><pre><code>ActivityMainBinding binding = DataBindingUtil.setContentView(this, R.layout.activity_main);
</code></pre><h2 id="4-接下来就是关键的ViewModel层"><a href="#4-接下来就是关键的ViewModel层" class="headerlink" title="4. 接下来就是关键的ViewModel层"></a>4. 接下来就是关键的<code>ViewModel</code>层</h2><h4 id="a-单向绑定"><a href="#a-单向绑定" class="headerlink" title="a. 单向绑定"></a>a. 单向绑定</h4><p>咱们先从简单的开始，<code>DataBinding</code>有个很大的好处就是摒弃原生<code>findViewById</code>频繁的遍历视图层和<code>ButterKnife</code>的反射，采用的是数组记录每个<code>view</code></p>
<pre><code>final Object[] bindings = mapBindings(bindingComponent, root, 8, sIncludes, sViewsWithIds);
</code></pre><p>在<code>XML</code>创建一个<code>TextView</code></p>
<pre><code>&lt;TextView
    android:id=&quot;@+id/tv_content&quot;
    android:text=&quot;@{student.name}&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;50dp&quot;/&gt;
</code></pre><p>在代码中通过<code>binding</code>直接可以获取到这个<code>TextView</code></p>
<pre><code>mBinding.tvContent
</code></pre><p>那么如何实现单向绑定呢？</p>
<pre><code>Student student = new Student(&quot;xiaweizi&quot;, 12);
mBinding.setStudent(student);
</code></pre><p>这样就可以直接改变<code>TextView</code>的值。</p>
<p><code>ViewModel</code>就是简单的数据</p>
<pre><code>public class Student {
    public String name;
    public int age;
    public Student(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
</code></pre><h4 id="b-双向绑定"><a href="#b-双向绑定" class="headerlink" title="b. 双向绑定"></a>b. 双向绑定</h4><p>之前说的单向绑定，即当数据变化，通过<code>mBinding.setStudent(student)</code>方式驱动UI的改变<br>而双向绑定，无论<code>View</code>还是<code>ViewModel</code>谁改变，都会驱动另一方的改变，实现双向绑定有两种方式：继承<code>BaseObservable</code>和使用<code>ObservableField</code>创建成员变量。</p>
<p>代码实现：<br>第一种继承<code>BaseObservable</code>：</p>
<pre><code>public class Student extends BaseObservable{

    // 如果是 public 则在成员变量上方加上 @Bindable 注解
    @Bindable
    public String sex;

    public void setSex(String sex) {
        this.sex = sex;
        notifyPropertyChanged(BR.sex);
    }

    /*************************** 我是分割线 ***************************/
    // 如果是 private 则在成员变量的 get 方法中添加 @Bindable 注解
    private String name;
    @Bindable
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
        notifyPropertyChanged(BR.name);
    }

    public void setSexName(String name, String sex){
        this.name = name;
        this.sex = sex;
        notifyChange();
    }
}
</code></pre><p>这个时候当调用<code>setName()</code>方法,不仅数据改变，UI中的<code>TextView</code>内容也会随之改变。</p>
<p>我们可以发现有两个方法：<code>notifyPropertyChanged()</code>和<code>notifyChange</code>,一个是更新指定的变量，第二个是更新所有该<code>ViewModel</code>中的对象。</p>
<p>而<code>notifyPropertyChanged(int fieldId)</code>里面传的参数，即上面通过<code>@Bindable</code>注解创建对应的变量<code>id</code>。</p>
<p>第二种：使用<code>ObservableField</code></p>
<pre><code>public class Student extends BaseObservable{

    public ObservableField&lt;String&gt; name = new ObservableField&lt;&gt;();

    private ObservableInt age = new ObservableInt();
    public void setAge(int age) {
        this.age.set(age);
    }
    public int getAge() {
        return age.get();
    }
}
</code></pre><p>通过使用<code>ObservableField</code>创建的对象作用相当于第一种的方案，支持<code>ObservableInt</code>、<code>ObservableBoolean</code>或者是<code>ObservableField&lt;T&gt;</code>指定的类型、<code>ObservableArrayMap&lt;String, Object&gt;</code>、<code>ObservableArrayList&lt;Object&gt;</code>等。</p>
<p><code>ObservableField</code>内部已经封装了<code>get</code>和<code>set</code>方法，如果成员变量是<code>public</code>属性，直接通过</p>
<pre><code>mStudent.name.set(&quot;shabi&quot;);
String name = mStudent.name.get();
</code></pre><p>设置和获取对应的成员变量的值。</p>
<h1 id="其他使用"><a href="#其他使用" class="headerlink" title="其他使用"></a>其他使用</h1><p>学会了上面基本的用户还是远远不够的，像按钮的点击事件或是<code>EditText</code>内容的监听，这些也是非常重要的，不过学会了一种，其他的举一反三就会容易的多了。</p>
<h3 id="1-事件处理"><a href="#1-事件处理" class="headerlink" title="1. 事件处理"></a>1. 事件处理</h3><p><code>dataBinding</code>需要你通过一些表达式来处理<code>view</code>的分发事件，除了少数例子外，事件元素的名称是由监听器中的方法所控制。比如<code>View.OnLongClickListener</code>内部有<code>onLongClick()</code>方法，所以<code>XML</code>定义的事件就为<code>android:onLongClick</code>.</p>
<p>可以直接在<code>Activity</code>内部定义一个类，用于处理事件的监听</p>
<pre><code>public class Presenter {
    public void onClickExample(View view) {
        Toast.makeText(SimpleActivity.this, &quot;点到了&quot;, Toast.LENGTH_SHORT).show();
    }

    public void onTextChanged(CharSequence s, int start, int before, int count) {
        mStudent.name.set(s.toString());
    }

    public void onClickListenerBinding(Student student) {
        Toast.makeText(SimpleActivity.this, student.name.get(),Toast.LENGTH_SHORT).show();
    }
}
</code></pre><p><code>XML</code>中:</p>
<pre><code>&lt;EditText
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:hint=&quot;输入name&quot;
    android:onTextChanged=&quot;@{presenter::onTextChanged}&quot;/&gt;


&lt;TextView
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:onClick=&quot;@{presenter.onClickExample}&quot;
    android:text=&apos;@{&quot;年龄：&quot; + student.age}&apos;/&gt;

&lt;TextView
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_marginLeft=&quot;5dp&quot;
    android:onClick=&quot;@{() -&gt; presenter.onClickListenerBinding(student)}&quot;
    android:text=&apos;@{&quot;姓名：&quot; + student.name}&apos;/&gt;
</code></pre><p>首先从点击事件开始分析，<code>android:onClick=&quot;@{presenter.onClickExample}&quot;</code> 里面对应的方法自然是要与<code>Presenter</code>定义的方法名一致，名字可以不为<code>onClickExample</code>，但是参数必须是<code>View</code>，参数要对应于<code>setOnClickListener(onClickListener listener)</code>对应的<code>onClickListener</code>要实现的接口，即<code>public void onClick(View)</code>。</p>
<p>同理，监听<code>EditText</code>文本的变化，一般只要注意<code>onTextChanged(CharSequence s, int start, int before, int count)</code>方法即可，那么我们可以创建与之对应的方法，在<code>XML</code>文件中引用：<code>android:onTextChanged=&quot;@{presenter::onTextChanged}&quot;</code>。</p>
<p>最后再来看从UI中获取数据，也就是数据的回调，即<code>DataBinding</code>的精髓支出，<code>View</code>和<code>ViewModel</code>双向绑定。<code>android:onClick=&quot;@{() -&gt; presenter.onClickListenerBinding(student)}</code>这里用到了<code>lamda</code>表达式，这样就可以不遵循默认的方法签名，将<code>student</code>对象直接传回点击方法中。来看一下实现效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/4043475-6355339021fd68cb.gif?imageMogr2/auto-orient/strip" alt="简单测试.gif"></p>
<p>一目了然，我就不赘述了，我们可以发现一点，一开始我们并没有给<code>Student</code>对象设置值，所以显示的是<code>null</code>，并没有报空指针异常，这也是<code>DataBinding</code>的有点之一。</p>
<p>其实<code>dataBinding</code>自带对数据监听的方法：</p>
<pre><code>&lt;EditText
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&quot;@={student.name}&quot;/&gt;
</code></pre><p>代码中：</p>
<pre><code>student.addOnPropertyChangedCallback(new Observable.OnPropertyChangedCallback() {
        @Override
        public void onPropertyChanged(Observable observable, int i) {
            // i 为 BR 文件中对应的 int 值
            Log.i(&quot;xwz---&gt;&quot;, student.getName());
            Log.i(&quot;xwz---&gt;&quot;, student.getAge());
        }
});
</code></pre><p>这个对数据的监听建立在，使用<code>@Bindable</code>作为双向绑定为条件，当数据变化，便会出发<code>onPropertyChanged</code>方法。需要注意的是<code>android:text=&quot;@={student.name}&quot;</code>，@后面多了一个<code>=</code>。</p>
<h3 id="2-ViewStub和include"><a href="#2-ViewStub和include" class="headerlink" title="2. ViewStub和include"></a>2. <code>ViewStub</code>和<code>include</code></h3><p><code>dataBinding</code>同样是支持<code>ViewStub</code>的，使用起来也很简单，直接贴代码了。</p>
<pre><code>&lt;ViewStub
    android:id=&quot;@+id/view_stub&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout=&quot;@layout/viewstub&quot;/&gt;
</code></pre><p>代码中：</p>
<pre><code>View inflate = binding.viewStub.getViewStub().inflate();
</code></pre><p><code>inflate</code>即为替代<code>ViewStub</code>的<code>View</code>.</p>
<p>至于<code>include</code>更简单，用法跟以前是差不多，唯一不同的是可以将<code>ViewModel</code>传到下一个<code>XML</code>中：</p>
<pre><code>&lt;include layout=&quot;@layout/layout_include&quot; bind:student=&quot;@{student}&quot;/&gt;
</code></pre><p><code>layout_include</code>中同样可以共享<code>student</code>这个对象。</p>
<h3 id="3-BindingAdapter的使用"><a href="#3-BindingAdapter的使用" class="headerlink" title="3. BindingAdapter的使用"></a>3. <code>BindingAdapter</code>的使用</h3><p>我们之前用的都是<code>Android</code>自带的监听或是属性，比如<code>text</code>、<code>onClick</code>，但是如果项目中需要动态改变<code>ImageView</code>的内容，那我们应该怎么办呢？<code>dataBinding</code>给我们提供了<code>BindingAdapter</code>这个注解，方便我们定义自定义的属性。<br>假如我们有个需求，点击按钮更换图片，这个时候我们需要定义静态的方法：</p>
<pre><code>@BindingAdapter({&quot;url&quot;, &quot;name&quot;})
public static void loadImageView(ImageView view, String url, String name) {
    Log.i(&quot;xwz---&gt;&quot;, url + &quot;\t&quot; + name);
    Glide.with(view.getContext())
         .load(url)
         .into(view);
}
</code></pre><p>在<code>XML</code>中使用</p>
<pre><code>&lt;ImageView
    android:layout_width=&quot;160dp&quot;
    android:layout_height=&quot;160dp&quot;
    bind:name=&quot;@{student.name}&quot;
    bind:url=&quot;@{student.imgUrl}&quot;/&gt;
</code></pre><p>这里有必要解释一下，静态方法<code>loadImageView</code>里第一个参数为作用的<code>View</code>，这里是<code>ImageView</code>;后面的参数即分别对应于<code>@BindingAdapter</code>里面的参数。那这里是怎么跟<code>View</code>联系在一块呢？我们发现<code>XML</code>中有这样一行代码<code>bind:name=&quot;@{student.name}</code>这里的<code>name</code>对应的的<code>@BindingAdapter</code>注解里的参数<code>name</code>，并映射于<code>ViewModel</code>中的<code>student.name</code>。当<code>student.name</code>值改变，就会触发<code>loadImageView</code>方法，从而执行里面的方法。</p>
<p><code>bind</code>名称是任意的定义的，不过要定义对应的命名空间<code>xmlns:bind=&quot;http://schemas.android.com/apk/res-auto&quot;</code>。</p>
<p>实现的效果就很简单了：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/4043475-4f03698849422487.gif?imageMogr2/auto-orient/strip" alt="bindAdapter.gif"></p>
<p>更强大的在于可以覆盖<code>Android</code>原生的元素设置属性，比如<code>android:text</code>最常见不过了</p>
<pre><code>@BindingAdapter (&quot;android:text&quot;)
public static void setText(TextView view, String text) {
    view.setText(text + &quot;xiaweizi&quot;);
    Log.i(&quot;xwz---&gt;&quot;, text);
}
</code></pre><p>XML：</p>
<pre><code>&lt;TextView
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&apos;@{&quot;测试&quot;}&apos;/&gt;
</code></pre><p>这个时候所有设置<code>text</code>的地方后缀全部加上了<code>xiaweizi</code>.</p>
<h3 id="4-BindingConversion"><a href="#4-BindingConversion" class="headerlink" title="4. @BindingConversion"></a>4. <code>@BindingConversion</code></h3><p><code>dataBinding</code>还支持对数据的转换，或者是类型的转换</p>
<pre><code>@BindingConversion
public static String addString(String text){
    Log.i(&quot;xwz---&gt;&quot;, &quot;DemoBindingAdapter:  &quot; + &quot;addString: &quot; + text);
    return text + &quot;xiaweizi&quot;;
}
</code></pre><p>这个时候会将项目中所有以<code>@{String}</code>方式用到的<code>String</code>后缀全部加上<code>xiaweizi</code>.</p>
<pre><code>@BindingConversion
public static ColorDrawable convertColorToDrawable(int color){
   return new ColorDrawable(color);
}
</code></pre><p><code>XML</code>:</p>
<pre><code>&lt;View
   android:background=&quot;@{isError ? @color/red : @color/white}&quot;
   android:layout_width=&quot;wrap_content&quot;
   android:layout_height=&quot;wrap_content&quot;/&gt;
</code></pre><p>这段代码的作用在于将<code>int</code>类型的<code>color</code>值，转换成了<code>ColorDrawable</code>类型.</p>
<h3 id="5-DataBindingComponent"><a href="#5-DataBindingComponent" class="headerlink" title="5. DataBindingComponent"></a>5. DataBindingComponent</h3><p>通过<code>BindingAdapter</code>是可以增加一些自定义的属性或者是修改<code>Android</code>原生的属性，但是它有一个弊端，就是全局修改所有的相关属性，不过配合上<code>DataBindingComponent</code>就可以解决这个问题。</p>
<pre><code>DataBindingUtil.setContentView(this, R.layout.activity_component, new FirstComponent());
</code></pre><p>开始的是以一个参数的形式传入这个<code>View</code>中，那么只作用于当前的view。</p>
<pre><code>DataBindingUtil.setDefaultComponent(new FirstComponent());
</code></pre><p>或者是这种设置全局的方式，也可以改变。</p>
<p><code>DataBindingComponent</code>其实是一个空方法的接口，你需要先创建一个拥有<code>@BindingAdapter</code>的类，这里就不能定义为<code>public</code>，因为这样<code>DataBindingComponent</code>就找不到对应的类，我们为了方便后期的开发，可以定义一个抽象类：</p>
<pre><code>public abstract class AbstractAdapter {
    @BindingAdapter (&quot;text&quot;)
    public abstract void setText(TextView textView, String text);
}
</code></pre><p>然后定义一个实现类：</p>
<pre><code>public class FirstAdapter extends AbstractAdapter{
    @Override
    public void setText(TextView textView, String text) {
        Log.i(&quot;xwz---&gt;&quot;, &quot;FirstAdapter:  &quot; + &quot;setText: &quot;);
        textView.setText(text+&quot;first&quot;);
    }
}
</code></pre><p>这个时候当你创建一个实现<code>DataBindingComponent</code>接口的类时，会发现让你实现一个方法：</p>
<pre><code>public class FirstComponent implements android.databinding.DataBindingComponent {
    @Override
    public AbstractAdapter getAbstractAdapter() {
        return new FirstAdapter();
    }
}
</code></pre><p>这里返回的就是创建的<code>adapter</code>，可以根据需求创建对应的<code>component</code>.</p>
<h1 id="RecyclerView中的应用"><a href="#RecyclerView中的应用" class="headerlink" title="RecyclerView中的应用"></a>RecyclerView中的应用</h1><p>除了最基本的使用，还有一个频繁出现的就是列表了，那么我们这里就拿<code>RecyclerView</code>作为代表进行演示。</p>
<p><code>RecyclerView</code>的好处就不多说了，已经完全代替了之前的<code>ListView</code>和<code>GridView</code>，用法也就不赘述了，这里主要介绍一下适配器的编写。虽然网上有很多大神已经帮我们创建了各种通用的<code>adapter</code>，不过作为入门，我们还是要学习一下使用<code>dataBinding</code>创建<code>adapter</code>.</p>
<p>先来个简单的<code>XML</code>文件：</p>
<pre><code>&lt;layout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
    &lt;data&gt;
        &lt;import type=&quot;com.github.markzhai.sample.Person&quot;/&gt;
        &lt;variable
            name=&quot;person&quot;
            type=&quot;Person&quot;/&gt;
    &lt;/data&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:orientation=&quot;vertical&quot;&gt;

        &lt;TextView
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:textSize=&quot;24sp&quot;
            android:padding=&quot;5dp&quot;
            android:textColor=&quot;#f0f&quot;
            android:text=&apos;@{&quot;姓名：&quot; + person.name, default=&quot;aaa&quot;}&apos;/&gt;
        &lt;TextView
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:textSize=&quot;15sp&quot;
            android:padding=&quot;2dp&quot;
            android:textColor=&quot;#090&quot;
            android:gravity=&quot;right&quot;
            android:layout_marginRight=&quot;80dp&quot;
            android:text=&apos;@{&quot;年龄：&quot; + person.age, default=12}&apos;/&gt;
    &lt;/LinearLayout&gt;
&lt;/layout&gt;
</code></pre><p>至于<code>ViewModel</code>就是一个简单的<code>Person</code>类，拥有<code>name</code>和<code>age</code>两个属性，接下来就是<code>adapte</code>的编写。</p>
<pre><code>public class MyAdapter extends RecyclerView.Adapter&lt;MyAdapter.ViewHolder&gt; {

    private List&lt;Person&gt; mList;    
    public MyAdapter() {
        mList = new ArrayList&lt;&gt;();
    }
    public void setData(List&lt;Person&gt; persons) {
        this.mList = persons;
    }

    @Override
    public MyAdapter.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
        ItemRecyclerBinding itemBinding = 
                    DataBindingUtil.inflate(LayoutInflater.from(parent.getContext()),
                                                                  R.layout.item_recycler,
                                                                  parent,
                                                                  false);

        return new ViewHolder(itemBinding);
    }

    @Override
    public void onBindViewHolder(MyAdapter.ViewHolder holder, int position) {
        holder.bind(mList.get(position));
    }

    @Override
    public int getItemCount() {
        return mList.size();
    }

    public static class ViewHolder extends RecyclerView.ViewHolder {

        final ItemRecyclerBinding itemBinding;

        public ViewHolder(ItemRecyclerBinding binding) {
            super(binding.getRoot());
            this.itemBinding = binding;
        }

        void bind(Person person) {
            itemBinding.setPerson(person);
        }
    }
}
</code></pre><p>通过<code>DataBindingUtil.inflate()</code>创建<code>item</code>布局，在<code>ViewHolder</code>中进行数据的绑定，这个时候，当数据源变化的时候，<code>RecyclerView</code>中的数据也跟着变化。</p>
<p>至于<code>item</code>的点击事件可以上面的<code>onClick</code>写法：</p>
<p>创建<code>Presenter</code>处理点击事件：</p>
<pre><code>public static class Presenter{
    ItemRecyclerBinding mBinding;
    public Presenter(ItemRecyclerBinding binding){
        this.mBinding = binding;
    }
    public void onItemClick(Person person){
        Log.i(&quot;xwz---&gt;&quot;, &quot;name: &quot; + person.getName() + &quot;\tage: &quot; + person.getAge());
        Toast.makeText(mBinding.getRoot().getContext(), &quot;name: &quot; + person.getName() + &quot;\tage: &quot; + person.getAge(), Toast.LENGTH_SHORT).show();
    }
}
</code></pre><p>在之前的<code>bind</code>方法中进行绑定：</p>
<pre><code>void bind(Person person) {
    itemBinding.setPerson(person);
    itemBinding.setPresenter(new Presenter(itemBinding));
}
</code></pre><p>在<code>XML</code>中设置点击事件即可：</p>
<pre><code>&lt;LinearLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:onClick=&quot;@{() -&gt; presenter.onItemClick(person)}&quot;
    android:orientation=&quot;vertical&quot;&gt;
...
&lt;/LinearLayout&gt;
</code></pre><p>这里就可以直接将数据直接回传。</p>
<p>看一下运行效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/4043475-50a7029e02b7693b.gif?imageMogr2/auto-orient/strip" alt="RecyclerView的使用.gif"></p>
<h1 id="一些细节"><a href="#一些细节" class="headerlink" title="一些细节"></a>一些细节</h1><h3 id="databinding支持一些java的表达式"><a href="#databinding支持一些java的表达式" class="headerlink" title="databinding支持一些java的表达式"></a><code>databinding</code>支持一些<code>java</code>的表达式</h3><ul>
<li><code>+ - * / %</code></li>
<li>字符串的连接<code>&quot;a&quot;+&quot;b&quot;</code></li>
<li>逻辑和位运算<code>&amp;&amp; || &amp; |</code></li>
<li>一元运算<code>+ - ! ~</code></li>
<li>移位 <code>&gt;&gt; &gt;&gt;&gt; &lt;&lt;</code></li>
<li>比较 <code>== &gt; &lt; &gt;= &lt;=</code></li>
<li><code>instance of</code></li>
<li>支持数据类型:<code>character,String,numeric,null</code></li>
<li>强转<code>cast</code></li>
<li>方法的调用</li>
<li>成员变量的访问</li>
<li>数组访问</li>
<li>三元表达式<code>? :</code></li>
</ul>
<p>简单例子：</p>
<pre><code>android:text=&quot;@{String.valueOf(index + 1)}&quot;
android:visibility=&quot;@{age &lt; 13 ? View.GONE : View.VISIBLE}&quot;
android:transitionName=&apos;@{&quot;image_&quot; + id}&apos;
</code></pre><h3 id="dataBinding不支持的Java特性"><a href="#dataBinding不支持的Java特性" class="headerlink" title="dataBinding不支持的Java特性"></a><code>dataBinding</code>不支持的<code>Java</code>特性</h3><ul>
<li><code>this</code></li>
<li>super</li>
<li>new</li>
<li>泛型</li>
</ul>
<h3 id="dataBinding判空处理"><a href="#dataBinding判空处理" class="headerlink" title="dataBinding判空处理"></a><code>dataBinding</code>判空处理</h3><p>使用<code>??</code>来进行判空操作</p>
<pre><code>android:text=&quot;@{user.displayName ?? user.lastName}&quot;
</code></pre><p>如果不为空则选择左侧值，否则选择右侧值，类似于：</p>
<pre><code>android:text=&quot;@{user.displayName != null ? user.displayName : user.lastName}&quot;
</code></pre><h3 id="支持数组，集合，map"><a href="#支持数组，集合，map" class="headerlink" title="支持数组，集合，map"></a>支持数组，集合，<code>map</code></h3><pre><code>&lt;data&gt;
    &lt;import type=&quot;android.util.SparseArray&quot;/&gt;
    &lt;import type=&quot;java.util.Map&quot;/&gt;
    &lt;import type=&quot;java.util.List&quot;/&gt;
    &lt;variable name=&quot;list&quot; type=&quot;List&lt;String&gt;&quot;/&gt;
    &lt;variable name=&quot;sparse&quot; type=&quot;SparseArray&lt;String&gt;&quot;/&gt;
    &lt;variable name=&quot;map&quot; type=&quot;Map&lt;String, String&gt;&quot;/&gt;
    &lt;variable name=&quot;index&quot; type=&quot;int&quot;/&gt;
    &lt;variable name=&quot;key&quot; type=&quot;String&quot;/&gt;
&lt;/data&gt;
…
android:text=&quot;@{list[index]}&quot;
…
android:text=&quot;@{sparse[index]}&quot;
…
android:text=&quot;@{map[key]}&quot;
</code></pre><h3 id="资源的访问"><a href="#资源的访问" class="headerlink" title="资源的访问"></a>资源的访问</h3><p><code>dataBinding</code>支持一般语法对资源的访问：</p>
<pre><code>android:padding=&quot;@{large? @dimen/largePadding : @dimen/smallPadding}&quot;
</code></pre><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p><code>dataBinding</code>主要的作用就在于减少<code>Activity</code>和<code>Fragment</code>层的代码,不再使用<code>findViewById</code>，让<code>XML</code>从之前只用于显示视图，到现在可以做一些操作。在性能上更是有很大的提高，内部采用0反射，使用位标记检测需要更新的<code>view</code>，每次数据的改变是在下一帧开始改变等等。</p>
<p>当然也有一些不足之处，<code>Android Studio</code>的<code>IDE</code>支持还不是那么完善，在<code>XML</code>中一些方法不能智能生成和跳转，还有就是报错的错误信息，有的时候并不能定位到准确的位置。不过总体上来说<code>dataBinding</code>带来的好处远远的超过这些不足，所以还没有尝试的小伙伴，不妨试一试，相信你会爱上他的。</p>
<blockquote>
<p>感谢<a href="http://www.imooc.com/search/?words=databinding" target="_blank" rel="noopener">dataBinding视频</a><br><a href="http://blog.zhaiyifan.cn/" target="_blank" rel="noopener">markzhai</a><br><a href="https://developer.android.google.cn/topic/libraries/data-binding/index.html" target="_blank" rel="noopener">官方地址</a></p>
</blockquote>
<p><a href="http://xiaweizi.cn">我的博客</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/article/41851/">MVVM之DataBinding入门</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">下位子</a></p>
        <p><span>发布时间:</span>2017-08-30, 20:46:25</p>
        <p><span>最后更新:</span>2018-03-09, 10:14:16</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/article/41851/" title="MVVM之DataBinding入门">http://xiaweizi.cn/article/41851/</a>
            <span class="copy-path" data-clipboard-text="原文: http://xiaweizi.cn/article/41851/　　作者: 下位子" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/article/40024/">
                    Kotlin学习笔记
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/article/35908/">
                    『自定义View实战』—— 实现图片的圆角效果
                </a>
            </div>
        
    </nav>

  
  
    
    <div style="padding: 0; margin: 20px auto; width: 90%; text-align: center;">
      <br>
      <div>赏我 e(=2.72) 元咖啡钱吧，您的支持将鼓励我继续创作！</div>
      <br>
      <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
        <div class="btn btn-pay">打赏支持</div>
      </button>
      <br>
      <br>
      <div id="QR" style="display: none;">
        
          <div id="wechat" style="display: inline-block;">
            <img id="wechat_qr" src="/img/wechat-reward-qr.png" alt="下位子 WeChat Pay"/>
            <p>微信打赏</p>
          </div>
        
        
          <div id="alipay" style="display: inline-block">
            <img id="alipay_qr" src="/img/alipay-reward-qr.png" alt="下位子 Alipay"/>
            <p>支付宝打赏</p>
          </div>
        
        <br>
        <br>
      </div>
    </div>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MVVM介绍"><span class="toc-number">1.</span> <span class="toc-text">MVVM介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#初步使用"><span class="toc-number">2.</span> <span class="toc-text">初步使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-module的build-gradle文件加上一行配置代码"><span class="toc-number">2.1.</span> <span class="toc-text">1. module的build.gradle文件加上一行配置代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-创建布局文件"><span class="toc-number">2.2.</span> <span class="toc-text">2. 创建布局文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Activity中替换原来的setContentView-代码"><span class="toc-number">2.3.</span> <span class="toc-text">3. Activity中替换原来的setContentView()代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-接下来就是关键的ViewModel层"><span class="toc-number">2.4.</span> <span class="toc-text">4. 接下来就是关键的ViewModel层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-单向绑定"><span class="toc-number">2.4.0.1.</span> <span class="toc-text">a. 单向绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-双向绑定"><span class="toc-number">2.4.0.2.</span> <span class="toc-text">b. 双向绑定</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#其他使用"><span class="toc-number">3.</span> <span class="toc-text">其他使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-事件处理"><span class="toc-number">3.0.1.</span> <span class="toc-text">1. 事件处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ViewStub和include"><span class="toc-number">3.0.2.</span> <span class="toc-text">2. ViewStub和include</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-BindingAdapter的使用"><span class="toc-number">3.0.3.</span> <span class="toc-text">3. BindingAdapter的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-BindingConversion"><span class="toc-number">3.0.4.</span> <span class="toc-text">4. @BindingConversion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-DataBindingComponent"><span class="toc-number">3.0.5.</span> <span class="toc-text">5. DataBindingComponent</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RecyclerView中的应用"><span class="toc-number">4.</span> <span class="toc-text">RecyclerView中的应用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#一些细节"><span class="toc-number">5.</span> <span class="toc-text">一些细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#databinding支持一些java的表达式"><span class="toc-number">5.0.1.</span> <span class="toc-text">databinding支持一些java的表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dataBinding不支持的Java特性"><span class="toc-number">5.0.2.</span> <span class="toc-text">dataBinding不支持的Java特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dataBinding判空处理"><span class="toc-number">5.0.3.</span> <span class="toc-text">dataBinding判空处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#支持数组，集合，map"><span class="toc-number">5.0.4.</span> <span class="toc-text">支持数组，集合，map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#资源的访问"><span class="toc-number">5.0.5.</span> <span class="toc-text">资源的访问</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#小结"><span class="toc-number">6.</span> <span class="toc-text">小结</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-6 i,
        .toc-level-6 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"MVVM之DataBinding入门　| xiaweizi'blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







        
      <section class="livere" id="comments">
    <!-- 来必力City版安装代码 -->
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zNDM3Ny8xMDkxNA==">
    <script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
       })(document, 'script');
    </script>
    <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
    </div>
    <!-- City版安装代码已完成 -->
</section>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/article/40024/" title="上一篇: Kotlin学习笔记">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/article/35908/" title="下一篇: 『自定义View实战』—— 实现图片的圆角效果">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/article/5d77/">『自定义View实战』—— 仿ios图标下载view</a></li><li class="post-list-item"><a class="post-list-link" href="/article/3cfa/">程序员必备软件(持续更新中...)</a></li><li class="post-list-item"><a class="post-list-link" href="/article/typora/">『程序员必备软件』—— 编辑预览于一身的 Typora</a></li><li class="post-list-item"><a class="post-list-link" href="/article/7b67faab/">读书笔记(持续更新...)</a></li><li class="post-list-item"><a class="post-list-link" href="/article/31905/">hexo 博客小功能添加-评论、相册、字数统计...</a></li><li class="post-list-item"><a class="post-list-link" href="/article/39434/">个人博客全新上线(阿里域名+GitPages+hexo+Yelee)</a></li><li class="post-list-item"><a class="post-list-link" href="/article/34201/">Android 冷兵器 之 tools</a></li><li class="post-list-item"><a class="post-list-link" href="/article/25968/">『自定义View实战』—— 银行种类选择器</a></li><li class="post-list-item"><a class="post-list-link" href="/article/46688/">我和极光的那些事---我和-Android-推送的时间简史</a></li><li class="post-list-item"><a class="post-list-link" href="/article/18215/">Python-自学笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/article/6515/">Google-最新模拟器重磅来袭！秒开并还原到之前工作状态！</a></li><li class="post-list-item"><a class="post-list-link" href="/article/13147/">『自定义View实战』—— 跑马灯</a></li><li class="post-list-item"><a class="post-list-link" href="/article/31642/">Android-分享会：Material-Design-在-Android-中的应用</a></li><li class="post-list-item"><a class="post-list-link" href="/article/52360/">Git-命令小结</a></li><li class="post-list-item"><a class="post-list-link" href="/article/13823/">使用Kotlin重构项目</a></li><li class="post-list-item"><a class="post-list-link" href="/article/40024/">Kotlin学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/article/41851/">MVVM之DataBinding入门</a></li><li class="post-list-item"><a class="post-list-link" href="/article/35908/">『自定义View实战』—— 实现图片的圆角效果</a></li><li class="post-list-item"><a class="post-list-link" href="/article/9202/">Android-性能优化小结</a></li><li class="post-list-item"><a class="post-list-link" href="/article/58454/">如何做个依赖库让别人依赖使用</a></li><li class="post-list-item"><a class="post-list-link" href="/article/64590/">jsoup爬虫简书首页数据做个小Demo</a></li><li class="post-list-item"><a class="post-list-link" href="/article/64591/">jsoup爬虫简书首页数据做个小Demo</a></li><li class="post-list-item"><a class="post-list-link" href="/article/7691/">基于MaterialDesign设计风格的妹纸app的简单实现</a></li><li class="post-list-item"><a class="post-list-link" href="/article/62207/">快毕业了，撸一个小项目(新闻段子客户端)</a></li><li class="post-list-item"><a class="post-list-link" href="/article/2954/">基于LitePal操作数据库的学生管理系统的简单实现</a></li><li class="post-list-item"><a class="post-list-link" href="/article/276/">基于环信的仿QQ即时通讯的简单实现</a></li><li class="post-list-item"><a class="post-list-link" href="/article/7455/">高大上的侧滑菜单DrawerLayout，解决了不能全屏滑动的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/article/7798/">简单粗暴----RecyclerView</a></li><li class="post-list-item"><a class="post-list-link" href="/article/23091/">设计模式之建造者模式学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/article/17984/">一个菜鸟的图片三级缓存笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_12/">『Thinking in Java 读书笔记』—— 12-通过异常处理错误</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_11/">『Thinking in Java 读书笔记』—— 11-持有对象</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_10/">『Thinking in Java 读书笔记』—— 10-内部类</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_9/">『Thinking in Java 读书笔记』—— 9-接口</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_8/">『Thinking in Java 读书笔记』—— 8-多态</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_7/">『Thinking in Java 读书笔记』—— 7-复用类</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_6/">『Thinking in Java 读书笔记』—— 6-访问权限控制</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_5/">『Thinking in Java 读书笔记』—— 5-初始化与清理</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_4/">『Thinking in Java 读书笔记』—— 4-控制执行流程</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_3/">『Thinking in Java 读书笔记』—— 3-操作符</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_2/">『Thinking in Java 读书笔记』—— 2-一切都是对象</a></li><li class="post-list-item"><a class="post-list-link" href="/article/thinking_in_java_1/">『Thinking in Java 读书笔记』—— 1-对象导论</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2018 下位子
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_uv">
                      您是第 <span id="busuanzi_value_site_uv"></span> 位小伙伴
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
                    </span>
                
                <span>| </span>
                <span class="post-count">  已经写了 61.2k 字啦</span>
            </div>
        
    </div>
</footer>
    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#e040fb", "#7c4dff", "#3d5afe", "#0288d1", "#0091ea", "#00e5ff", "#1de9b6", "#14e715", "#14e715", "#76ff03", "#ffea00", "#ff3d00", "#ff2d6f"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 6;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-113850534-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "插播广告中... " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "广告结束，精彩继续！" + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

	<script type="text/javascript" src="/resources/love.js"></script>
	<script type="text/javascript" src="/resources/float.js"></script>
	<script type="text/javascript" src="/resources/typewriter.js"></script>
	<script type="text/javascript" color=0,104,183 opacity=1 zindex=-1 count=50 src="/resources/particle.js"></script>


  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":false},"react":{"opacityDefault":0.5,"opacityOnHover":0.2}});</script></body>
</html>